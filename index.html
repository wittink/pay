<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>송금 안내</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-sm mx-auto bg-white rounded-3xl shadow-2xl p-8 text-center">
        <h2 class="text-xl font-bold mb-6 text-gray-800">계좌 정보를 확인해주세요</h2>
        
        <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 mb-8">
            <div id="displayBank" class="text-blue-600 font-bold text-lg leading-tight">로딩중...</div>
            <div id="displayAcc" class="text-2xl font-mono font-bold my-2 text-gray-900 tracking-tighter">000-000-0000</div>
            <div id="displayName" class="text-sm font-medium text-gray-500">예금주 로딩중...</div>
        </div>
        
        <button id="confirmBtn" onclick="handleConfirm()" 
            class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all">
            계좌번호 복사 및 은행 앱 열기
        </button>

        <p class="mt-4 text-[11px] text-gray-400">안드로이드는 설치된 은행 앱 목록이 나타납니다.</p>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const acc = params.get('acc') || '';
        document.getElementById('displayBank').innerText = params.get('bank') || '은행 정보';
        document.getElementById('displayAcc').innerText = acc || '계좌번호 없음';
        document.getElementById('displayName').innerText = `예금주: ${params.get('name') || '미지정'}`;

        // 주소창 파라미터 숨기기
        if (window.location.search) window.history.replaceState({}, document.title, window.location.pathname);

        function handleConfirm() {
            if (!acc) return alert('계좌 정보가 없습니다.');

            // 1. 계좌번호 복사
            const el = document.createElement('textarea');
            el.value = acc;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            // 2. allqr.kr의 비법 (안드로이드 시스템 앱 선택기 강제 호출)
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('android')) {
                /**
                 * allqr이 사용하는 방식: 
                 * 특정 앱을 지정하지 않고 금융/뱅킹 앱들이 공통으로 반응하는 intent를 던집니다.
                 */
                const intent = [
                    'intent://pay?account=' + acc + '#Intent',
                    'action=android.intent.action.VIEW',
                    'category=android.intent.category.DEFAULT',
                    'category=android.intent.category.BROWSABLE',
                    'end'
                ].join(';');
                
                location.href = intent;
            } else {
                // iOS는 시스템 목록 기능이 없으므로 알림 처리
                alert("계좌번호가 복사되었습니다.\n은행 앱을 열어 붙여넣어 주세요.");
            }
        }
    </script>
</body>
</html>
