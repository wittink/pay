<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>송금 안내</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-sm bg-white rounded-3xl shadow-2xl p-8">
    <h2 class="text-xl font-bold text-center mb-6 text-gray-800">
      계좌 정보를 확인해주세요
    </h2>

    <!-- 계좌 정보 -->
    <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 text-center mb-6">
      <div id="displayBank" class="text-blue-600 font-bold text-lg">
        은행 정보 로딩중...
      </div>
      <div id="displayAcc" class="text-2xl font-mono font-bold my-2 text-gray-900">
        000-000-0000
      </div>
      <div id="displayName" class="text-sm font-medium text-gray-500">
        예금주 로딩중...
      </div>
    </div>

    <!-- 버튼 -->
    <button
      id="confirmBtn"
      onclick="copyAndOpen()"
      class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold text-lg shadow-lg hover:bg-blue-700 active:scale-95 transition-all"
    >
      계좌번호 복사하고 은행앱 열기
    </button>
  </div>

<script>
/* ===============================
   1. URL 파라미터 읽기
   =============================== */
const params = new URLSearchParams(location.search);
const bank = params.get("bank") || "은행 정보 없음";
const acc  = params.get("acc")  || "";
const name = params.get("name") || "예금주 미지정";

document.getElementById("displayBank").innerText = bank;
document.getElementById("displayAcc").innerText  = acc || "계좌번호 없음";
document.getElementById("displayName").innerText = `예금주: ${name}`;

/* ===============================
   2. 복사 + OS 앱 선택 호출
   =============================== */
function copyAndOpen() {
  if (!acc) {
    alert("계좌번호가 없습니다.");
    return;
  }

  navigator.clipboard.writeText(acc).then(() => {
    openOSPicker();
  }).catch(() => {
    alert("복사에 실패했습니다. 수동으로 복사해주세요.");
  });
}

/* ===============================
   3. 핵심: OS에게 위임
   =============================== */
function openOSPicker() {
  const text = `${bank}\n${acc}\n${name}`;

  // Android: SEND intent → 앱 선택창
  if (/android/i.test(navigator.userAgent)) {
    location.href =
      "intent://send/#Intent;" +
      "action=android.intent.action.SEND;" +
      "type=text/plain;" +
      "S.android.intent.extra.TEXT=" + encodeURIComponent(text) + ";" +
      "end";
    return;
  }

  // iOS: Web Share API → 공유 시트 (은행앱 포함)
  if (navigator.share) {
    navigator.share({
      text: text
    });
    return;
  }

  alert("이 기능은 모바일에서만 사용 가능합니다.");
}
</script>

</body>
</html>
